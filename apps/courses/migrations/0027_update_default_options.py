# Generated by Django 5.2.3 on 2025-10-03 18:20

from django.db import migrations

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ CBC (Ù‡Ù…Ø§Ù† Ù‚Ø¨Ù„ÛŒ)
CBC_DEFAULT_OPTIONS = [
    'Polycythemia',
    'No abnormalities',
    'Mild nonregenerative anemia',
    'Mild regenerative anemia',
    'Neutrophilia',
    'Neutropenia',
    'Lymphopenia',
    'Lymphocytosis',
    'Eosinophilia',
    'Eosinopenia',
    'Monocytosis',
]

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ CHEM
CHEM_DEFAULT_OPTIONS = [
    'No abnormalities',
    'Physiological hypoglycemia',
    'Physiological hyperglycemia',
    'Significative hyperglycemia',
    'Artifactual hypoglycemia',
    'Uremia',
    'Low urea',
    'High liver enzymes',
    'Hyperproteinemia',
    'Hypoproteinemia',
    'Hypoalbuminemia',
    'Hyperglobulinemia',
    'Physiological hypercalcemia',
    'Significant hypercalcemia',
    'Hypocalcemia (hypoalbuminemia)',
    'Significant hypocalcemia',
    'Hyperphosphatemia',
    'Hyperkalemia',
    'Hypokalemia',
    'Hypernatremia',
    'Hyponatremia',
    'Hyperchloremia',
    'Hypochloremia',
    'High anion gap metabolic acidosis',
    'Hyperchloremic metabolic acidosis',
    'Metabolic alkalosis',
    'Mixed acid-base disorder',
]

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ MORPHO
MORPHO_DEFAULT_OPTIONS = [
    'No abnormalities',
    'Reactive lymphocytes',
    'Circulating blasts',
    'Spherocytes',
    'Acanthocytes',
    'Keratocytes',
    'Schizocytes',
    'Heinz bodies',
    'Howell-Joly bodies',
    'Autoagglutination',
    'Microcytosis',
    'Megaloblasts',
    'Nucleated red blood cells',
    'Toxic neutrophils',
    'Immature neutrophils',
]

def update_default_options(apps, schema_editor):
    """Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"""
    LabTest = apps.get_model('courses', 'LabTest')
    UserObservation = apps.get_model('courses', 'UserObservation')
    
    print("ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶...")
    
    # Ø­Ø°Ù Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
    old_default_tests = LabTest.objects.filter(lab_type__in=['CBC_DEFAULT', 'CHEM_DEFAULT', 'MORPHO_DEFAULT'])
    for test in old_default_tests:
        UserObservation.objects.filter(case_test=test).delete()
        test.delete()
        print(f"âœ… Ø­Ø°Ù Ø´Ø¯: {test.lab_type}")
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
    case = apps.get_model('courses', 'Case').objects.first()
    user = apps.get_model('users', 'CustomUser').objects.first()
    
    if not case or not user:
        print("âŒ Case ÛŒØ§ User ÛŒØ§ÙØª Ù†Ø´Ø¯!")
        return
    
    # Ø§ÛŒØ¬Ø§Ø¯ CBC_DEFAULT Ø¬Ø¯ÛŒØ¯
    cbc_test = LabTest.objects.create(
        case=case,
        lab_type='CBC_DEFAULT',
        lab_name='Complete Blood Count (Default Options)',
        lab_result='N/A',
        normal_range='N/A',
    )
    
    for i, option in enumerate(CBC_DEFAULT_OPTIONS):
        UserObservation.objects.create(
            case_test=cbc_test,
            observation_text=option,
            user=user,
            case=case,
            is_correct=False,
            order_index=i,
        )
    print(f"âœ… CBC_DEFAULT: {len(CBC_DEFAULT_OPTIONS)} Ú¯Ø²ÛŒÙ†Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ CHEM_DEFAULT Ø¬Ø¯ÛŒØ¯
    chem_test = LabTest.objects.create(
        case=case,
        lab_type='CHEM_DEFAULT',
        lab_name='Clinical Chemistry (Default Options)',
        lab_result='N/A',
        normal_range='N/A',
    )
    
    for i, option in enumerate(CHEM_DEFAULT_OPTIONS):
        UserObservation.objects.create(
            case_test=chem_test,
            observation_text=option,
            user=user,
            case=case,
            is_correct=False,
            order_index=i,
        )
    print(f"âœ… CHEM_DEFAULT: {len(CHEM_DEFAULT_OPTIONS)} Ú¯Ø²ÛŒÙ†Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ MORPHO_DEFAULT Ø¬Ø¯ÛŒØ¯
    morpho_test = LabTest.objects.create(
        case=case,
        lab_type='MORPHO_DEFAULT',
        lab_name='Morphology (Default Options)',
        lab_result='N/A',
        normal_range='N/A',
    )
    
    for i, option in enumerate(MORPHO_DEFAULT_OPTIONS):
        UserObservation.objects.create(
            case_test=morpho_test,
            observation_text=option,
            user=user,
            case=case,
            is_correct=False,
            order_index=i,
        )
    print(f"âœ… MORPHO_DEFAULT: {len(MORPHO_DEFAULT_OPTIONS)} Ú¯Ø²ÛŒÙ†Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    print("ğŸ‰ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯!")

def reverse_update_default_options(apps, schema_editor):
    """Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù‚Ø¨Ù„"""
    LabTest = apps.get_model('courses', 'LabTest')
    UserObservation = apps.get_model('courses', 'UserObservation')
    
    # Ø­Ø°Ù Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
    new_default_tests = LabTest.objects.filter(lab_type__in=['CBC_DEFAULT', 'CHEM_DEFAULT', 'MORPHO_DEFAULT'])
    for test in new_default_tests:
        UserObservation.objects.filter(case_test=test).delete()
        test.delete()
    
    print("Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯")

class Migration(migrations.Migration):

    dependencies = [
        ('courses', '0026_create_default_options'),
        ('users', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(update_default_options, reverse_update_default_options),
    ]
