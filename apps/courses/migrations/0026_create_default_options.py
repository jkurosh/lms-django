# Generated by Django 5.2.3 on 2025-10-03 12:00

from django.db import migrations

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ CBC
CBC_DEFAULT_OPTIONS = [
    'Polycythemia',
    'No abnormalities', 
    'Mild nonregenerative anemia',
    'Mild regenerative anemia',
    'Neutrophilia',
    'Neutropenia',
    'Lymphopenia',
    'Lymphocytosis',
    'Eosinophilia',
    'Eosinopenia',
    'Monocytosis',
]

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ CHEM
CHEM_DEFAULT_OPTIONS = [
    'Hypoglycemia',
    'Hyperglycemia',
    'Hypoalbuminemia',
    'Hyperalbuminemia',
    'Hypocalcemia',
    'Hypercalcemia',
    'Hypophosphatemia',
    'Hyperphosphatemia',
    'Hypokalemia',
    'Hyperkalemia',
    'Hyponatremia',
    'Hypernatremia',
    'Hypochloremia',
    'Hyperchloremia',
    'Azotemia',
    'Elevated liver enzymes',
    'Elevated creatinine',
    'Elevated BUN',
    'Elevated cholesterol',
    'Elevated triglycerides',
    'Elevated bilirubin',
    'Elevated alkaline phosphatase',
    'Elevated ALT',
    'Elevated AST',
    'Elevated GGT',
    'Elevated LDH',
    'Elevated CK',
]

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ MORPHO
MORPHO_DEFAULT_OPTIONS = [
    'Normal morphology',
    'Abnormal RBC morphology',
    'Abnormal WBC morphology',
    'Abnormal platelet morphology',
    'Schistocytes',
    'Spherocytes',
    'Target cells',
    'Burr cells',
    'Acanthocytes',
    'Elliptocytes',
    'Ovalocytes',
    'Teardrop cells',
    'Basophilic stippling',
    'Howell-Jolly bodies',
    'Heinz bodies',
    'Nucleated RBCs',
    'Immature granulocytes',
    'Atypical lymphocytes',
    'Reactive lymphocytes',
    'Plasma cells',
    'Blast cells',
    'Hypersegmented neutrophils',
    'Hyposegmented neutrophils',
    'Toxic granulation',
    'Dohle bodies',
    'Vacuoles',
    'Large platelets',
    'Small platelets',
    'Giant platelets',
    'Platelet clumps',
]

def create_default_options(apps, schema_editor):
    """Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³"""
    Case = apps.get_model('courses', 'Case')
    LabTest = apps.get_model('courses', 'LabTest')
    UserObservation = apps.get_model('courses', 'UserObservation')
    User = apps.get_model('users', 'CustomUser')
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† case
    case = Case.objects.first()
    if not case:
        print("Ù‡ÛŒÚ† case Ø§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!")
        return
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±
    user = User.objects.first()
    if not user:
        print("Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!")
        return
    
    print(f"Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ case: {case.title}")
    
    # Ø§ÛŒØ¬Ø§Ø¯ CBC test Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
    cbc_test, created = LabTest.objects.get_or_create(
        case=case,
        lab_type='CBC_DEFAULT',
        defaults={
            'lab_name': 'Complete Blood Count (Default Options)',
            'lab_result': 'N/A',
            'normal_range': 'N/A',
        }
    )
    
    if created:
        print("CBC_DEFAULT test Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ CHEM test Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
    chem_test, created = LabTest.objects.get_or_create(
        case=case,
        lab_type='CHEM_DEFAULT',
        defaults={
            'lab_name': 'Clinical Chemistry (Default Options)',
            'lab_result': 'N/A',
            'normal_range': 'N/A',
        }
    )
    
    if created:
        print("CHEM_DEFAULT test Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ MORPHO test Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
    morpho_test, created = LabTest.objects.get_or_create(
        case=case,
        lab_type='MORPHO_DEFAULT',
        defaults={
            'lab_name': 'Morphology (Default Options)',
            'lab_result': 'N/A',
            'normal_range': 'N/A',
        }
    )
    
    if created:
        print("MORPHO_DEFAULT test Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ CBC observations
    print("Ø§ÛŒØ¬Ø§Ø¯ CBC observations...")
    for i, option in enumerate(CBC_DEFAULT_OPTIONS):
        UserObservation.objects.get_or_create(
            case_test=cbc_test,
            observation_text=option,
            defaults={
                'user': user,
                'case': case,
                'is_correct': False,  # Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ØºÙ„Ø·
                'order_index': i,
            }
        )
    
    print(f"âœ… {len(CBC_DEFAULT_OPTIONS)} CBC observation Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ CHEM observations
    print("Ø§ÛŒØ¬Ø§Ø¯ CHEM observations...")
    for i, option in enumerate(CHEM_DEFAULT_OPTIONS):
        UserObservation.objects.get_or_create(
            case_test=chem_test,
            observation_text=option,
            defaults={
                'user': user,
                'case': case,
                'is_correct': False,  # Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ØºÙ„Ø·
                'order_index': i,
            }
        )
    
    print(f"âœ… {len(CHEM_DEFAULT_OPTIONS)} CHEM observation Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    # Ø§ÛŒØ¬Ø§Ø¯ MORPHO observations
    print("Ø§ÛŒØ¬Ø§Ø¯ MORPHO observations...")
    for i, option in enumerate(MORPHO_DEFAULT_OPTIONS):
        UserObservation.objects.get_or_create(
            case_test=morpho_test,
            observation_text=option,
            defaults={
                'user': user,
                'case': case,
                'is_correct': False,  # Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ØºÙ„Ø·
                'order_index': i,
            }
        )
    
    print(f"âœ… {len(MORPHO_DEFAULT_OPTIONS)} MORPHO observation Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    print("ğŸ‰ Ù‡Ù…Ù‡ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯!")

def reverse_create_default_options(apps, schema_editor):
    """Ø­Ø°Ù Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"""
    LabTest = apps.get_model('courses', 'LabTest')
    UserObservation = apps.get_model('courses', 'UserObservation')
    
    # Ø­Ø°Ù default tests
    LabTest.objects.filter(lab_type__in=['CBC_DEFAULT', 'CHEM_DEFAULT', 'MORPHO_DEFAULT']).delete()
    
    print("Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯")

class Migration(migrations.Migration):

    dependencies = [
        ('courses', '0025_add_user_to_userobservation'),
        ('users', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(create_default_options, reverse_create_default_options),
    ]
