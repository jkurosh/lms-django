{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ case.title }} - Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ÛŒ</title>
    <link rel="stylesheet" href="{% static 'dadash/styles.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-stethoscope"></i>
                    <h1>Ø¯Ø§Ù…Ù¾Ø²Ø´Ú©ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† - Heyvoonak</h1>
                </div>
                <nav class="nav">
                    <ul>
                        <li><a href="{% url 'heyvoonak:dadash_home' %}">Ø®Ø§Ù†Ù‡</a></li>
                        <li><a href="{% url 'cases:case_list' %}">Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ÛŒ</a></li>
                        <li><a href="{% url 'heyvoonak:internal_diseases' %}">Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ</a></li>
                        <li><a href="#">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Section Header -->
            <div class="section-header">
                <a href="{% url 'cases:case_list' %}" class="back-btn">
                    <i class="fas fa-arrow-right"></i>
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ÛŒ
                </a>
                <h2 class="section-title">{{ case.title }}</h2>
            </div>

            <!-- Case Info -->
            <div class="case-info">
                <div class="case-description">
                    <h3>Ù¾ÛŒØ´ÛŒÙ†Ù‡ Ú©ÛŒØ³:</h3>
                    <p>{{ case.history }}</p>
                </div>
            </div>

            <!-- Test Selection -->
            <div class="test-selection">
                <h3>Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø²Ù…Ø§ÛŒØ´:</h3>
                <div class="test-buttons">
                    <button onclick="showTest('cbc', this)" class="test-btn">
                        <span>ğŸ©¸</span>
                        CBC
                    </button>
                    <button onclick="showTest('chem', this)" class="test-btn">
                        <span>ğŸ§ª</span>
                        CLIN.CHEMISTRY
                    </button>
                    <button onclick="showTest('morpho', this)" class="test-btn">
                        <span>ğŸ”¬</span>
                        MORPHOLOGICAL
                    </button>
                    <button onclick="showTest('other', this)" class="test-btn">
                        <span>ğŸ”¬</span>
                        OTHER TESTS
                    </button>
                    <button onclick="showTest('slide', this)" class="test-btn">
                        <span>ğŸ”</span>
                        SLIDES
                    </button>
                </div>
            </div>

            <!-- Main Layout -->
            <div class="main-layout">
                <div class="left-panel">
                    <h3>Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</h3>
                    <div id="observations" class="observations-container">
                        <p>ÛŒÚ©ÛŒ Ø§Ø² Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</p>
                    </div>
                </div>
                
                <div class="right-panel">
                    <h3>Ú¯Ø²Ø§Ø±Ø´ Ø¢Ø²Ù…Ø§ÛŒØ´:</h3>
                    <div id="test-report" class="test-report-container">
                        <p>ÛŒÚ©ÛŒ Ø§Ø² Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
                    </div>
                </div>
            </div>

            <!-- Test Form -->
            <div id="test-form" class="test-form hidden">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§:</h3>
                <form id="test-form-element">
                    <div id="test-questions"></div>
                    <button type="button" onclick="submitTest()" class="submit-test-btn">
                        <span>ğŸ“</span>
                        Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§
                    </button>
                </form>
            </div>

            <!-- Test Results Section -->
            <div id="test-results" class="test-results-section hidden">
                <h3>Ù†ØªØ§ÛŒØ¬ ØªØ³Øª:</h3>
                <div id="test-score" class="test-score"></div>
                <div id="retry-section" class="retry-section hidden">
                    <p>Ø´Ù…Ø§ <span id="attempts-count">0</span> Ø§Ø² <span id="max-attempts">3</span> ØªÙ„Ø§Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
                    <button onclick="retryTest()" class="retry-btn">
                        <span>ğŸ”„</span>
                        ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
                    </button>
                </div>
            </div>

            <!-- Diagnosis Section -->
            <div id="diagnosis-section" class="diagnosis-section hidden">
                <h3>ØªØ´Ø®ÛŒØµ Ù†Ù‡Ø§ÛŒÛŒ Ø´Ù…Ø§:</h3>
                <p>Ø´Ù…Ø§ 3 Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ú©Ø±Ø¯ÛŒØ¯. Ø­Ø§Ù„Ø§ ØªØ´Ø®ÛŒØµ Ù†Ù‡Ø§ÛŒÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
                <textarea id="diagnosis-input" placeholder="ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                <button onclick="submitDiagnosis()" class="diagnosis-btn">
                    <span>âœ…</span>
                    Ø§ØªÙ…Ø§Ù… ØªØ´Ø®ÛŒØµ
                </button>
            </div>

            <!-- Result Section -->
            <div id="result" class="result-section hidden">
                <h3>Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ:</h3>
                <div class="result-content">
                    <div id="user-diagnosis" class="user-diagnosis">
                        <h4>ØªØ´Ø®ÛŒØµ Ø´Ù…Ø§:</h4>
                        <p id="user-diagnosis-text"></p>
                    </div>
                    <div class="explanations">
                        <h4>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØ´Ø±ÛŒØ­ÛŒ:</h4>
                        {% for explanation in explanations %}
                        <div class="explanation-item">
                            <h5>{{ explanation.title }}</h5>
                            <p>{{ explanation.content }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆØ± Ø¨Ù‡ JS -->
            {{ tests|json_script:"test-data" }}
            {% csrf_token %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</h4>
                    <p>Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù…ÙˆØ±Ø¯ Ø¯Ø§Ù…Ù¾Ø²Ø´Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ø§Ø±ØªÙ‚Ø§ÛŒ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ´Ø®ÛŒØµÛŒ</p>
                </div>
                <div class="footer-section">
                    <h4>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</h4>
                    <p><i class="fas fa-envelope"></i> info@vetcases.com</p>
                    <p><i class="fas fa-phone"></i> 021-12345678</p>
                </div>
                <div class="footer-section">
                    <h4>Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-telegram"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯Ø§Ù…Ù¾Ø²Ø´Ú©ÛŒ. ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
            </div>
        </div>
    </footer>

    <script>
        // ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
        let attempts = 0;
        const maxAttempts = 3;
        let currentTestType = '';
        let userProgress = null;

        // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø§Ø² Ø³Ø±ÙˆØ±
        const testDataElement = document.getElementById('test-data');
        let testData = [];
        
        if (testDataElement && testDataElement.textContent) {
            try {
                testData = JSON.parse(testDataElement.textContent);
                console.log('Test data loaded successfully:', testData);
            } catch (e) {
                console.error('Error parsing test data:', e);
                testData = [];
            }
        }

        function showTest(testType, buttonElement) {
            // Ø­Ø°Ù Ú©Ù„Ø§Ø³ active Ø§Ø² Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('.test-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ active Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            currentTestType = testType;
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØªØ³Øª Ù…Ø±Ø¨ÙˆØ·Ù‡
            const test = testData.find(t => t.test_category === testType.toUpperCase());
            
            if (!test) {
                document.getElementById("test-report").innerHTML = `
                    <div style="color: red; padding: 20px; text-align: center; background: #fee; border: 1px solid #fcc; border-radius: 8px;">
                        <h4>Ø¢Ø²Ù…Ø§ÛŒØ´ ÛŒØ§ÙØª Ù†Ø´Ø¯!</h4>
                        <p>Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Admin Panel Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</p>
                    </div>
                `;
                document.getElementById("observations").innerHTML = `
                    <div style="color: red; padding: 20px; text-align: center; background: #fee; border: 1px solid #fcc; border-radius: 8px;">
                        <h4>Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!</h4>
                        <p>Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Admin Panel Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</p>
                    </div>
                `;
                return;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ ØªØ³Øªâ€ŒÙ‡Ø§
            displayTests(test);
        }
        
        function displayTests(test) {
            const testForm = document.getElementById('test-form');
            const testQuestions = document.getElementById('test-questions');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ù‚Ø¨Ù„ÛŒ
            testQuestions.innerHTML = '';
            
            // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… ØªØ³Øª
            test.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.innerHTML = `
                    <h4>Ø³ÙˆØ§Ù„ ${index + 1}: ${question.question}</h4>
                    <div class="options">
                        ${question.options.map((option, optIndex) => `
                            <label class="option-label">
                                <input type="radio" name="test_${question.id}" value="${option.id}">
                                <span class="option-text">${option.option_text}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                testQuestions.appendChild(questionDiv);
            });
            
            testForm.classList.remove('hidden');
        }
        
        function submitTest() {
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
            const answers = {};
            document.querySelectorAll('input[type="radio"]:checked').forEach(input => {
                const testId = input.name.replace('test_', '');
                answers[testId] = input.value;
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù¾Ø§Ø³Ø® Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
            if (Object.keys(answers).length === 0) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ÙˆØ§Ù„ Ø±Ø§ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.');
                return;
            }
            
            // Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ±
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            
            fetch('{% url "cases:submit_test" case.id %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken.value
                },
                body: Object.keys(answers).map(key => `test_${key}=${answers[key]}`).join('&')
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    attempts = data.attempts;
                    userProgress = data;
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
                    showTestResults(data);
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªÙ„Ø§Ø´â€ŒÙ‡Ø§
                    if (data.can_retry) {
                        showRetrySection();
                    } else if (data.should_show_diagnosis) {
                        showDiagnosisSection();
                    }
                }
            })
            .catch(error => {
                console.error('Error submitting test:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ØªØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            });
        }
        
        function showTestResults(data) {
            const testResults = document.getElementById('test-results');
            const testScore = document.getElementById('test-score');
            
            testScore.innerHTML = `
                <div class="score-display">
                    <h4>Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${data.score.toFixed(1)}%</h4>
                    <p>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­: ${data.correct_answers} Ø§Ø² ${data.total_questions}</p>
                    <p>ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´: ${data.attempts} Ø§Ø² ${data.max_attempts}</p>
                </div>
            `;
            
            testResults.classList.remove('hidden');
        }
        
        function showRetrySection() {
            const retrySection = document.getElementById('retry-section');
            const attemptsCount = document.getElementById('attempts-count');
            const maxAttempts = document.getElementById('max-attempts');
            
            attemptsCount.textContent = attempts;
            maxAttempts.textContent = userProgress.max_attempts;
            retrySection.classList.remove('hidden');
        }
        
        function showDiagnosisSection() {
            const diagnosisSection = document.getElementById('diagnosis-section');
            diagnosisSection.classList.remove('hidden');
        }
        
        function retryTest() {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
            document.getElementById('test-results').classList.add('hidden');
            document.getElementById('retry-section').classList.add('hidden');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            document.querySelectorAll('input[type="radio"]:checked').forEach(input => {
                input.checked = false;
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§
            showTest(currentTestType);
        }
        
        function submitDiagnosis() {
            const diagnosis = document.getElementById('diagnosis-input').value.trim();
            
            if (!diagnosis) {
                alert('Ù„Ø·ÙØ§Ù‹ ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            
            fetch('{% url "cases:submit_diagnosis" case.id %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken.value
                },
                body: `diagnosis=${encodeURIComponent(diagnosis)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showFinalResults(diagnosis);
                } else {
                    alert(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ØªØ´Ø®ÛŒØµ');
                }
            })
            .catch(error => {
                console.error('Error submitting diagnosis:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ØªØ´Ø®ÛŒØµ. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            });
        }
        
        function showFinalResults(diagnosis) {
            const result = document.getElementById('result');
            const userDiagnosisText = document.getElementById('user-diagnosis-text');
            
            userDiagnosisText.textContent = diagnosis;
            result.classList.remove('hidden');
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
            document.getElementById('test-results').classList.add('hidden');
            document.getElementById('diagnosis-section').classList.add('hidden');
        }

        // Ø¨Ø§Ø± Ø§ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± CBC Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
        window.addEventListener('load', () => {
            try {
                console.log('Page loaded, showing CBC test...');
                console.log('Available test data:', testData);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ ØªØ³Øª CBC Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
                const cbcTest = testData.find(t => t.test_category === 'CBC');
                if (cbcTest) {
                    showTest('cbc');
                    const firstBtn = document.querySelector('.test-btn');
                    if (firstBtn) {
                        firstBtn.classList.add('active');
                    }
                } else {
                    console.log('CBC test not found, showing first available test...');
                    if (testData.length > 0) {
                        const firstTest = testData[0];
                        showTest(firstTest.test_category.toLowerCase());
                        const firstBtn = document.querySelector('.test-btn');
                        if (firstBtn) {
                            firstBtn.classList.add('active');
                        }
                    } else {
                        console.error('No tests available!');
                        document.getElementById("test-report").innerHTML = '<p style="color: red; padding: 20px; text-align: center;">Ù‡ÛŒÚ† ØªØ³ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Admin Panel Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</p>';
                        document.getElementById("observations").innerHTML = '<p style="color: red; padding: 20px; text-align: center;">Ù‡ÛŒÚ† ØªØ³ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Admin Panel Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</p>';
                    }
                }
            } catch (error) {
                console.error('Error in page load event:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ refresh Ú©Ù†ÛŒØ¯.');
            }
        });
    </script>

    <style>
        /* Override background to remove purple */
        body {
            background: #f8fafc !important;
        }
        
        .main {
            background: #f8fafc !important;
        }

        /* Custom styles */
        .case-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .case-info h3 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .case-info p {
            color: #4b5563;
            line-height: 1.6;
            font-size: 1rem;
        }

        .test-selection {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .test-selection h3 {
            color: #1f2937;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .test-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.3);
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .left-panel, .right-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .left-panel h3, .right-panel h3 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .test-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .question-item {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
        }

        .question-item h4 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 0.5rem;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-label:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .option-label input[type="radio"]:checked + .option-text {
            color: #667eea;
            font-weight: 600;
        }

        .option-label input[type="radio"]:checked {
            accent-color: #667eea;
        }

        .submit-test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .submit-test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .test-results-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .score-display {
            text-align: center;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .score-display h4 {
            color: #1f2937;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .retry-section {
            text-align: center;
            padding: 1rem;
            background: #fef3c7;
            border-radius: 0.75rem;
            border: 1px solid #f59e0b;
        }

        .retry-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }

        .diagnosis-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .diagnosis-section h3 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .diagnosis-section textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 1rem;
        }

        .diagnosis-section textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .diagnosis-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .diagnosis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .result-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-diagnosis {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .user-diagnosis h4 {
            color: #0c4a6e;
            margin-bottom: 0.5rem;
        }

        .explanations {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .explanations h4 {
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .explanation-item {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
        }

        .explanation-item h5 {
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .explanation-item p {
            color: #4b5563;
            line-height: 1.6;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .test-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
